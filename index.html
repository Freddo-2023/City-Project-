<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>NYC Architectural Inspector</title>
    <style>
        body { margin: 0; overflow: hidden; background: #050508; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        #info-panel { position: absolute; top: 20px; right: 20px; width: 280px; background: rgba(0,0,0,0.85); color: white; padding: 20px; border-radius: 10px; border: 1px solid #444; display: none; backdrop-filter: blur(5px); }
        #ui-top { position: absolute; top: 20px; left: 20px; color: white; pointer-events: none; }
        .btn { pointer-events: auto; background: #fec309; border: none; padding: 10px; cursor: pointer; font-weight: bold; border-radius: 5px; margin-top: 10px; }
        h2 { margin-top: 0; color: #fec309; }
    </style>
</head>
<body>

    <div id="ui-top">
        <h1>NYC Inspector v3</h1>
        <p>Click a building to see its history.</p>
        <button class="btn" onclick="toggleMusic()">ðŸŽµ Toggle Jazz Radio</button>
    </div>

    <div id="info-panel" id="panel">
        <h2 id="b-name">Building Name</h2>
        <p><strong>Year:</strong> <span id="b-year"></span></p>
        <p><strong>Type:</strong> <span id="b-type"></span></p>
        <p id="b-desc"></p>
        <button class="btn" style="background:#444; color:white" onclick="document.getElementById('info-panel').style.display='none'">Close</button>
    </div>

    <audio id="jazzAudio" loop>
        <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-17.mp3" type="audio/mpeg">
    </audio>

    <script type="module">
        import * as THREE from 'https://cdn.skypack.dev/three@0.132.2';
        import { OrbitControls } from 'https://cdn.skypack.dev/three@0.132.2/examples/jsm/controls/OrbitControls.js';

        // --- DATA ---
        const buildingData = [
            { name: "Empire Heights", year: "1931", type: "Art Deco Skyscraper", desc: "A limestone masterpiece defining the midtown skyline." },
            { name: "Greenwich Flats", year: "1895", type: "Residential Brownstone", desc: "Classic walk-up apartments with original brickwork." },
            { name: "Lexington Plaza", year: "2015", type: "Glass Commercial", desc: "Modern tech hub with floor-to-ceiling reinforced glass." },
            { name: "The Manhattanite", year: "1950", type: "Mid-Century Apartment", desc: "Post-war housing known for high ceilings and terrace views." }
        ];

        // --- SCENE SETUP ---
        const scene = new THREE.Scene();
        scene.fog = new THREE.FogExp2(0x050508, 0.005);
        const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 1, 1000);
        camera.position.set(100, 100, 100);

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        document.body.appendChild(renderer.domElement);

        const controls = new OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;

        // --- LIGHTING ---
        const sun = new THREE.DirectionalLight(0xffffff, 0.8);
        sun.position.set(100, 200, 100);
        scene.add(sun);
        scene.add(new THREE.AmbientLight(0x404050, 0.7));

        // --- PROCEDURAL TEXTURES ---
        function createCityTexture(isModern) {
            const canvas = document.createElement('canvas');
            canvas.width = 128; canvas.height = 256;
            const ctx = canvas.getContext('2d');
            ctx.fillStyle = isModern ? '#1a1a1a' : '#4a2525'; 
            ctx.fillRect(0,0,128,256);
            
            for(let y=10; y<250; y+=15) {
                for(let x=10; x<120; x+=12) {
                    ctx.fillStyle = Math.random() > 0.4 ? '#fff8cc' : '#111';
                    ctx.fillRect(x, y, 6, 8);
                }
            }
            return new THREE.CanvasTexture(canvas);
        }

        const modernTex = createCityTexture(true);
        const classicTex = createCityTexture(false);

        // --- CITY GENERATION ---
        const raycaster = new THREE.Raycaster();
        const mouse = new THREE.Vector2();
        const buildings = [];

        for(let i=-8; i<8; i++) {
            for(let j=-8; j<8; j++) {
                if(i < -4) continue; // River

                const x = i * 22;
                const z = j * 22;
                const isTall = Math.random() > 0.7;
                const h = isTall ? 60 + Math.random()*80 : 15 + Math.random()*20;
                
                const geo = new THREE.BoxGeometry(15, h, 15);
                const mat = new THREE.MeshPhongMaterial({ 
                    color: isTall ? 0x888899 : 0xaa8888, 
                    map: isTall ? modernTex : classicTex 
                });

                const b = new THREE.Mesh(geo, mat);
                b.position.set(x, h/2, z);
                
                // Attach Data
                b.userData = buildingData[Math.floor(Math.random() * buildingData.length)];
                
                scene.add(b);
                buildings.push(b);
            }
        }

        // --- WATER ---
        const water = new THREE.Mesh(
            new THREE.PlaneGeometry(500, 500),
            new THREE.MeshPhongMaterial({ color: 0x0a141a, shininess: 90 })
        );
        water.rotation.x = -Math.PI/2;
        water.position.set(-150, 0, 0);
        scene.add(water);

        // --- INTERACTION ---
        window.addEventListener('click', (event) => {
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

            raycaster.setFromCamera(mouse, camera);
            const intersects = raycaster.intersectObjects(buildings);

            if (intersects.length > 0) {
                const data = intersects[0].object.userData;
                document.getElementById('info-panel').style.display = 'block';
                document.getElementById('b-name').innerText = data.name;
                document.getElementById('b-year').innerText = data.year;
                document.getElementById('b-type').innerText = data.type;
                document.getElementById('b-desc').innerText = data.desc;
            }
        });

        // --- ANIMATION ---
        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }
        animate();

        window.toggleMusic = function() {
            const music = document.getElementById('jazzAudio');
            if (music.paused) music.play();
            else music.pause();
        }
    </script>
</body>
</html>
